---
title: "Tulcea dashboard"
output: 
  flexdashboard::flex_dashboard:
    theme: bootstrap
    logo: "img/logo_creating-interfaces_100x48.png"
    favicon: img/favicon.ico
    css: dashboard.css
    # orientation: rows
---

```{r setup, include=FALSE}
library(crosstalk)
library(DT)
library(flexdashboard)
library(ggplot2)
library(htmltools)
library(leaflet)
library(lubridate)
library(patchwork)
library(plotly)
library(reactable)
library(scales)
library(tidyverse)
library(wfenexus)

# Load data
salepoints_df <- read_csv("data/salepoints.csv") %>% 
  mutate(data_type = "Sale Points")

producers_df <- read.csv("data/producers.csv") %>% 
  mutate(data_type = "Producers")

combined_df <- salepoints_df %>% 
  full_join(producers_df)


# Colours
color_food <- "#95C448"
color_water <- "#00A9AE"
color_energy <- "#EBC11F"

color_background <- "#34767A"

color_wfp_blue <- "#65C6F0"
color_wfp_green <- "#A2D729"
color_wfp_grey <- "#8f8f98"

```

```{r ggplot_defaults}
# Custom ggplot theme.
mytheme_minimal <- theme_minimal(base_size = 12) +
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank(),
        plot.caption = element_text(size = 8, face = "italic", 
                                    colour = "grey60"),
        plot.subtitle = element_text(size = 9, face = "plain", 
                                     colour = "grey50"),
        axis.ticks = element_line(colour = "grey80"),
        axis.ticks.length = unit(2, "pt"),
        strip.text = element_text(size = 12))

mytheme <- theme_minimal(base_size = 12) +
  theme(plot.caption = element_text(size = 8, face = "italic", 
                                    colour = "grey60"),
        plot.subtitle = element_text(size = 9, face = "plain", 
                                     colour = "grey50"),
        axis.ticks = element_line(colour = "grey80"),
        axis.ticks.length = unit(2, "pt"),
        strip.text = element_text(size = 12))

theme_set(mytheme_minimal)


```

Interactive Map {data-icon="ion-map"}
=====================================  

```{r}
sd <- SharedData$new(combined_df)
```



Column {data-width=400}
-------------------------------------

### Filters

```{r filters}
filter_select(
  id = "sel_data_type",
  label = "Type of Point",
  sharedData = sd,
  group = ~data_type
)

bscols(
  filter_checkbox(
    id = "ckb_type",
    label = "Type",
    sharedData = sd,
    group = ~type
  ),
  filter_checkbox(
    id = "ckb_product",
    label = "Product",
    sharedData = sd,
    group = ~product
  )
)
# More columns can be added.
# bscols(
#   filter_slider(
#     id = "pupil_count",
#     label = "Pupil count",
#     sharedData = sd,
#     column = ~pupil_count,
#     step = 10,
#     round = TRUE,
#     sep = "",
#     ticks = FALSE
#   ),
#   filter_slider(
#     id = "pupil_percent_fsm",
#     label = "Percentage Free School Meals",
#     sharedData = sd,
#     column = ~pupil_percent_fsm,
#     step = 1,
#     round = TRUE,
#     sep = "",
#     ticks = FALSE
#   )
# )
```



### Datatable
    
```{r datatable}
sd %>% 
  DT::datatable(
    filter = "top",  # allows filtering on each column
    extensions = c(
      "Buttons",  # add download buttons, etc
      "Scroller"  # for scrolling down the rows rather than pagination
    ),
    rownames = FALSE,  # remove rownames
    style = "bootstrap",
    class = "compact",
    width = "100%",
    options = list(
      dom = "Blrtip",  # specify content (search box, etc)
      deferRender = TRUE,
      scrollY = 300,
      scroller = TRUE,
      columnDefs = list(
        list(
          visible = FALSE,
          targets = c(0, 8:13)
        )
      ), 
      buttons = list(
        I("colvis"),  # turn columns on and off
        "csv",  # download as .csv
        "excel"  # download as .xlsx
      )
    ),
    colnames = c(
      "id" = "id",
      "Name" = "name",
      "Type" = "type",
      "Product" = "product"
    )
  )
```




Column {.tabset .tabset-fade data-width=600}
-------------------------------------


### Interactive map
    
```{r}
groups <- c("Sale points")

map <- leaflet(sd) %>% 
  addProviderTiles("CartoDB.Positron", group = "Positron (default)", 
                   layerId = "basetile") %>% 
  addTiles(group = "OSM") %>% 
  addProviderTiles(providers$Stamen.Toner, group = "Toner") %>%
  addProviderTiles(providers$Stamen.TonerLite, group = "Toner Lite") %>%
  # addMiniMap(
  #   tiles = providers$CartoDB.Positron,
  #   toggleDisplay = TRUE ) %>% 
  # Add data
  addMarkers(data = sd, ~longitude, ~latitude, 
             popup = ~as.character(name), 
             label = ~as.character(name), 
             group = "Sale Points") %>% 
  # Adds controls
  addLayersControl(
    baseGroups = c("Positron (default)", "OSM", "Toner", "Toner Lite"),
    overlayGroups = c("Sale Points", "Outline"),
    options = layersControlOptions(collapsed = TRUE)
  ) %>% 
  leaflet::addMeasure()

map
```


### Plot

Plot here

# Overview


```{r}
groups <- c("Sale points")

map <- leaflet() %>% 
  addProviderTiles("CartoDB.Positron", group = "Positron (default)", 
                   layerId = "basetile") %>% 
  addTiles(group = "OSM") %>% 
  addProviderTiles(providers$Stamen.Toner, group = "Toner") %>%
  addProviderTiles(providers$Stamen.TonerLite, group = "Toner Lite") %>%
  # addMiniMap(
  #   tiles = providers$CartoDB.Positron,
  #   toggleDisplay = TRUE ) %>% 
  # Add data
  addMarkers(data = salepoints_df, ~longitude, ~latitude, 
             popup = ~as.character(name), 
             label = ~as.character(name), 
             group = "Sale Points") %>% 
  # Adds controls
  addLayersControl(
    baseGroups = c("Positron (default)", "OSM", "Toner", "Toner Lite"),
    overlayGroups = c("Sale Points", "Outline"),
    options = layersControlOptions(collapsed = TRUE)
  )

map



```


About {data-icon="ion-information-circled"}
===================================== 

#### About this dashboard

An open source prototype for a visual interface to support research and Nexus engagements, designed collaborativelly as part of [Creating interfaces](https://creatinginterfaces.eifer.kit.edu/)' WP4, developed by the [Institute for Global Sustainable Development](https://warwick.ac.uk/fac/arts/schoolforcross-facultystudies/igsd) at the [University of Warwick](https://warwick.ac.uk/).

![](img/IGSD_logo.jpg)

#### Aim

-   What are the consequences of our choices?
-   Which small changes can we make in our food to make them more sustainable?

#### Source Code

-   Source Code: <https://github.com/IGSD-UoW/wfenexus>
-   Licence: [GPL](https://github.com/IGSD-UoW/wfenexus/blob/main/LICENSE)
